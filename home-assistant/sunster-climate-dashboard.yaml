# Sunster Heater – modusabhängige Climate-Karte
# Im Automatic-Modus: Temperatur-Auswahl
# Im Manual- oder Lüften-Modus: Leistung 10–100%
#
# Anleitung:
# 1. Diese Inhalte in deine Home-Assistant-Konfiguration übernehmen
# 2. CLIMATE_ENTITY anpassen (z.B. climate.van_heater – in Einstellungen prüfen)
# 3. Optional: sensor und input_number in configuration.yaml
# 4. Die Karten-Konfiguration ins Dashboard einfügen

# ========== 1. Template-Sensor (in configuration.yaml unter template:) ==========
# Dieser Sensor bestimmt, ob Temperatur- oder Leistungs-UI angezeigt wird.
#
# template:
#   - sensor:
#       - name: "Van Heater UI Mode"
#         unique_id: sunster_van_heater_ui_mode
#         state: >
#           {% set e = 'climate.van_heater' %}
#           {% set preset = state_attr(e, 'preset_mode') %}
#           {% set mode = states(e) %}
#           {% if preset == 'Automatic' %}
#             temperature
#           {% elif preset == 'Manual' or mode == 'fan_only' %}
#             power
#           {% else %}
#             temperature
#           {% endif %}

# ========== 2. Input Number für Leistungs-Slider (optional, in configuration.yaml) ==========
# Ermöglicht einen Slider statt Buttons für die Leistung.
#
# input_number:
#   van_heater_power:
#     name: "Van Heater Leistung"
#     min: 10
#     max: 100
#     step: 10
#     unit_of_measurement: "%"
#     icon: mdi:percent
#     mode: slider

# ========== 3. Automations für Input-Number-Sync (wenn input_number verwendet) ==========
# automation:
#   - id: van_heater_power_to_climate
#     trigger:
#       - platform: state
#         entity_id:
#           - input_number.van_heater_power
#     action:
#       - service: climate.set_fan_mode
#         target:
#           entity_id: climate.van_heater
#         data:
#           fan_mode: "{{ states('input_number.van_heater_power') }}%"
#   - id: van_heater_climate_to_power
#     trigger:
#       - platform: state
#         entity_id:
#           - climate.van_heater
#         attribute:
#           - preset_mode
#           - fan_mode
#     condition:
#       - condition: template
#         value_template: "{{ state_attr('climate.van_heater', 'preset_mode') != 'Automatic' }}"
#     action:
#       - service: input_number.set_value
#         target:
#           entity_id: input_number.van_heater_power
#         data:
#           value: "{{ state_attr('climate.van_heater', 'fan_mode') | replace('%', '') | int | default(10) }}"

# ========== 4. Dashboard-Karten (untereinander oder in einer Spalte) ==========
# Ersetze climate.van_heater durch deine Climate-Entity-ID.

# Karte A: Temperatur-Anzeige (nur bei Automatic)
type: conditional
conditions:
  - condition: state
    entity: sensor.van_heater_ui_mode
    state: temperature
card:
  type: thermostat
  entity: climate.van_heater

---
# Karte B: Leistungs-Steuerung (bei Manual oder Lüften) – 10 Buttons
# Keine weiteren Helper nötig.
type: conditional
conditions:
  - condition: state
    entity: sensor.van_heater_ui_mode
    state: power
card:
  type: vertical
  cards:
    - type: entities
      entities:
        - entity: climate.van_heater
    - type: grid
      columns: 5
      square: false
      cards:
        - type: button
          name: "10%"
          tap_action:
            action: call-service
            service: climate.set_fan_mode
            target: { entity_id: climate.van_heater }
            data: { fan_mode: "10%" }
        - type: button
          name: "20%"
          tap_action:
            action: call-service
            service: climate.set_fan_mode
            target: { entity_id: climate.van_heater }
            data: { fan_mode: "20%" }
        - type: button
          name: "30%"
          tap_action:
            action: call-service
            service: climate.set_fan_mode
            target: { entity_id: climate.van_heater }
            data: { fan_mode: "30%" }
        - type: button
          name: "40%"
          tap_action:
            action: call-service
            service: climate.set_fan_mode
            target: { entity_id: climate.van_heater }
            data: { fan_mode: "40%" }
        - type: button
          name: "50%"
          tap_action:
            action: call-service
            service: climate.set_fan_mode
            target: { entity_id: climate.van_heater }
            data: { fan_mode: "50%" }
        - type: button
          name: "60%"
          tap_action:
            action: call-service
            service: climate.set_fan_mode
            target: { entity_id: climate.van_heater }
            data: { fan_mode: "60%" }
        - type: button
          name: "70%"
          tap_action:
            action: call-service
            service: climate.set_fan_mode
            target: { entity_id: climate.van_heater }
            data: { fan_mode: "70%" }
        - type: button
          name: "80%"
          tap_action:
            action: call-service
            service: climate.set_fan_mode
            target: { entity_id: climate.van_heater }
            data: { fan_mode: "80%" }
        - type: button
          name: "90%"
          tap_action:
            action: call-service
            service: climate.set_fan_mode
            target: { entity_id: climate.van_heater }
            data: { fan_mode: "90%" }
        - type: button
          name: "100%"
          tap_action:
            action: call-service
            service: climate.set_fan_mode
            target: { entity_id: climate.van_heater }
            data: { fan_mode: "100%" }
