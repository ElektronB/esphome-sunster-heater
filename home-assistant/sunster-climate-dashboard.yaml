# Sunster Heater – mode-dependent Climate card
# HVAC modes map to UI display:
#   AUTO     → Temperature control (thermostat card)
#   HEAT     → Power control 10–100% (slider)
#   FAN_ONLY → Fan only / power control (slider)
# Preset "Defreeze" → Antifreeze (autonomous temperature-based control)
#
# Setup:
# 1. Include template-sensor.yaml in configuration.yaml under template:
# 2. Include input-number.yaml in configuration.yaml under input_number:
# 3. Include automation.yaml in configuration.yaml under automation: (or as package)
# 4. Add both cards below to your dashboard
# 5. Replace climate.van_heater with your Climate entity ID if needed

# ========== 1. Template-Sensor (see template-sensor.yaml) ==========
# Determines whether to show temperature or power UI based on HVAC mode and preset.
#
# template:
#   - sensor:
#       - name: "Van Heater UI Mode"
#         unique_id: sunster_van_heater_ui_mode
#         state: >
#           {% set e = 'climate.van_heater' %}
#           {% set mode = states(e) %}
#           {% set preset = state_attr(e, 'preset_mode') %}
#           {% if preset == 'Defreeze' %}
#             defreeze
#           {% elif mode == 'auto' %}
#             temperature
#           {% elif mode in ['heat', 'fan_only'] %}
#             power
#           {% else %}
#             off
#           {% endif %}

# ========== 2. Automations (see automation.yaml) ==========
# automation:
#   - id: van_heater_power_to_climate
#     trigger:
#       - platform: state
#         entity_id:
#           - input_number.van_heater_power
#     action:
#       - service: climate.set_fan_mode
#         target:
#           entity_id: climate.van_heater
#         data:
#           fan_mode: "{{ states('input_number.van_heater_power') }}%"
#   - id: van_heater_climate_to_power
#     trigger:
#       - platform: state
#         entity_id:
#           - climate.van_heater
#         attribute: fan_mode
#     condition:
#       - condition: template
#         value_template: "{{ states('climate.van_heater') in ['heat', 'fan_only'] }}"
#     action:
#       - service: input_number.set_value
#         target:
#           entity_id: input_number.van_heater_power
#         data:
#           value: "{{ state_attr('climate.van_heater', 'fan_mode') | replace('%', '') | int | default(10) }}"

# ========== 3. Dashboard cards (stack vertically or in a column) ==========
# Replace climate.van_heater with your Climate entity ID.

# Card A: Temperature display (Auto mode only)
type: conditional
conditions:
  - condition: state
    entity: sensor.van_heater_ui_mode
    state: temperature
card:
  type: thermostat
  entity: climate.van_heater

---
# Card B: Power control (Heat or Fan Only mode) – slider
# Requires input_number.van_heater_power and automations (see folder).
type: conditional
conditions:
  - condition: state
    entity: sensor.van_heater_ui_mode
    state: power
card:
  type: entities
  entities:
    - entity: climate.van_heater
      secondary_info: last-changed
    - entity: input_number.van_heater_power
      name: Power Level
