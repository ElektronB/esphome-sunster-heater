# Sunster Heater – modusabhängige Climate-Karte
# Im Automatic-Modus: Temperatur-Auswahl
# Im Manual- oder Lüften-Modus: Leistung 10–100%
#
# Anleitung:
# 1. Template-Sensor (template-sensor.yaml) in configuration.yaml unter template: einbinden
# 2. Input Number (input-number.yaml) in configuration.yaml unter input_number: einbinden
# 3. Automations (automation.yaml) in configuration.yaml unter automation: einbinden (oder als package)
# 4. Beide Karten ins Dashboard einfügen
# 5. climate.van_heater ggf. durch deine Entity-ID ersetzen

# ========== 1. Template-Sensor (siehe template-sensor.yaml) ==========
# Dieser Sensor bestimmt, ob Temperatur- oder Leistungs-UI angezeigt wird.
#
# template:
#   - sensor:
#       - name: "Van Heater UI Mode"
#         unique_id: sunster_van_heater_ui_mode
#         state: >
#           {% set e = 'climate.van_heater' %}
#           {% set preset = state_attr(e, 'preset_mode') %}
#           {% set mode = states(e) %}
#           {% if preset == 'Automatic' %}
#             temperature
#           {% elif preset == 'Manual' or mode == 'fan_only' %}
#             power
#           {% else %}
#             temperature
#           {% endif %}

# ========== 3. Automations (siehe automation.yaml) ==========
# automation:
#   - id: van_heater_power_to_climate
#     trigger:
#       - platform: state
#         entity_id:
#           - input_number.van_heater_power
#     action:
#       - service: climate.set_fan_mode
#         target:
#           entity_id: climate.van_heater
#         data:
#           fan_mode: "{{ states('input_number.van_heater_power') }}%"
#   - id: van_heater_climate_to_power
#     trigger:
#       - platform: state
#         entity_id:
#           - climate.van_heater
#         attribute:
#           - preset_mode
#           - fan_mode
#     condition:
#       - condition: template
#         value_template: "{{ state_attr('climate.van_heater', 'preset_mode') != 'Automatic' }}"
#     action:
#       - service: input_number.set_value
#         target:
#           entity_id: input_number.van_heater_power
#         data:
#           value: "{{ state_attr('climate.van_heater', 'fan_mode') | replace('%', '') | int | default(10) }}"

# ========== 4. Dashboard-Karten (untereinander oder in einer Spalte) ==========
# Ersetze climate.van_heater durch deine Climate-Entity-ID.

# Karte A: Temperatur-Anzeige (nur bei Automatic)
type: conditional
conditions:
  - condition: state
    entity: sensor.van_heater_ui_mode
    state: temperature
card:
  type: thermostat
  entity: climate.van_heater

---
# Karte B: Leistungs-Steuerung (bei Manual oder Lüften) – Fader/Slider
# Benötigt input_number.van_heater_power und Automations (siehe Ordner).
type: conditional
conditions:
  - condition: state
    entity: sensor.van_heater_ui_mode
    state: power
card:
  type: entities
  entities:
    - entity: climate.van_heater
      secondary_info: last-changed
    - entity: input_number.van_heater_power
      name: Leistung
