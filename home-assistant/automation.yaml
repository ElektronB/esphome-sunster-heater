# Automations for bidirectional sync between input_number and climate.fan_mode
# Include in configuration.yaml under "automation:" (or import as package).
# Replace climate.van_heater and input_number.van_heater_power if your entity IDs differ.

- id: van_heater_power_to_climate
  alias: "Van Heater – Slider to Climate"
  description: "Syncs power slider changes to the Climate entity"
  trigger:
    - platform: state
      entity_id:
        - input_number.van_heater_power
  action:
    - service: climate.set_fan_mode
      target:
        entity_id: climate.van_heater
      data:
        fan_mode: "{{ states('input_number.van_heater_power') }}%"

- id: van_heater_climate_to_power
  alias: "Van Heater – Climate to Slider"
  description: "Syncs Climate fan_mode to power slider (in Heat/Fan Only mode)"
  trigger:
    - platform: state
      entity_id:
        - climate.van_heater
      attribute: fan_mode
    - platform: homeassistant
      event: start
  condition:
    - condition: template
      value_template: "{{ states('climate.van_heater') in ['heat', 'fan_only'] }}"
  action:
    - service: input_number.set_value
      target:
        entity_id: input_number.van_heater_power
      data:
        value: "{{ (state_attr('climate.van_heater', 'fan_mode') | default('10')) | replace('%', '') | int }}"
